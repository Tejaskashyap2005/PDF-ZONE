<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>PDF Zone</title>
	<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
	<!-- Favicon -->
    <link rel="icon" href="logo.ico.ico" type="image/x-icon">
</head>
<body>
	<!-- Background Video -->
	<video id="backgroundVideo" autoplay muted loop playsinline>
		<source src="{{ url_for('static', filename='videos/background.mp4') }}" type="video/mp4">
	</video>

	<!-- Top Left Logo -->
	<div class="logo">
		<img src="{{ url_for('static', filename='images/logo.png') }}" alt="Notes Zone Logo" />
	</div>

	<!-- Top Right Home Button -->
	<div class="home-button">
		<a href="https://noteszone.online/" class="btn-home">
			<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
				<path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
				<polyline points="9,22 9,12 15,12 15,22"></polyline>
			</svg>
			<span>Home</span>
		</a>
	</div>

	<!-- Main Content -->
	<main class="main-content">
		<!-- Title Section -->
		<div class="title-section">
			<h1 class="main-title">PDF Zone</h1>
			<p class="subtitle">Easily compress or convert your PDFs – right from your Notes Zone dashboard</p>
		</div>

		<!-- 
		<div class="character">
			<img src="{{ url_for('static', filename='images/character.png') }}" alt="Character pointing" />
		</div>
		-->

		<!-- Upload Card -->
		<div class="upload-card">
			<form id="uploadForm" action="#" method="post" enctype="multipart/form-data">
				<div id="dropzone" class="dropzone">
					<input id="fileInput" type="file" name="pdf" accept="application/pdf" hidden />
					<div class="dropzone-content">
						<p class="dz-title">Drag & Drop your PDF here</p>
						<p class="dz-sub">or</p>
						<button id="chooseBtn" type="button" class="btn btn-secondary">Choose File</button>
						<p id="fileName" class="file-name"></p>
					</div>
				</div>

				<div class="actions">
					<button id="compressBtn" type="button" class="btn btn-primary" disabled>Compress PDF</button>
					<button id="convertBtn" type="button" class="btn btn-secondary" disabled>Convert to JPG</button>
				</div>
			</form>
			<div id="loader" class="loader hidden">
				<div class="spinner"></div>
				<p>Processing...</p>
			</div>
		</div>
	</main>

	<!-- Footer -->
	<footer class="footer">
		<p>Crafted with ❤️ by Notes Zone</p>
	</footer>

	<script>
		const fileInput = document.getElementById('fileInput');
		const chooseBtn = document.getElementById('chooseBtn');
		const dropzone = document.getElementById('dropzone');
		const fileNameEl = document.getElementById('fileName');
		const compressBtn = document.getElementById('compressBtn');
		const convertBtn = document.getElementById('convertBtn');
		const loader = document.getElementById('loader');

		chooseBtn.addEventListener('click', () => fileInput.click());
		fileInput.addEventListener('change', () => {
			if (fileInput.files.length > 0) {
				fileNameEl.textContent = fileInput.files[0].name;
				compressBtn.disabled = false;
				convertBtn.disabled = false;
			}
		});

		dropzone.addEventListener('dragover', (e) => {
			e.preventDefault();
			dropzone.classList.add('dragover');
		});
		dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
		dropzone.addEventListener('drop', (e) => {
			e.preventDefault();
			dropzone.classList.remove('dragover');
			if (e.dataTransfer.files.length > 0) {
				const file = e.dataTransfer.files[0];
				if (file.type === 'application/pdf') {
					fileInput.files = e.dataTransfer.files;
					fileNameEl.textContent = file.name;
					compressBtn.disabled = false;
					convertBtn.disabled = false;
				} else {
					alert('Please drop a PDF file.');
				}
			}
		});

		function submitTo(endpoint) {
			if (fileInput.files.length === 0) return;
			const formData = new FormData();
			formData.append('pdf', fileInput.files[0]);
			loader.classList.remove('hidden');
			compressBtn.disabled = true;
			convertBtn.disabled = true;
			chooseBtn.disabled = true;

			fetch(endpoint, {
				method: 'POST',
				body: formData
			}).then(async (res) => {
				loader.classList.add('hidden');
				chooseBtn.disabled = false;
				if (!res.ok) {
					const text = await res.text().catch(() => '');
					alert('Something went wrong. ' + text);
					return;
				}
				const disposition = res.headers.get('Content-Disposition');
				const blob = await res.blob();
				let filename = 'download';
				if (disposition && disposition.includes('filename=')) {
					filename = disposition.split('filename=')[1].replaceAll('"', '');
				}
				const url = window.URL.createObjectURL(blob);
				const a = document.createElement('a');
				a.href = url;
				a.download = filename;
				document.body.appendChild(a);
				a.click();
				a.remove();
				window.URL.revokeObjectURL(url);
			}).catch(() => {
				loader.classList.add('hidden');
				chooseBtn.disabled = false;
				alert('Network error.');
			});
		}

		compressBtn.addEventListener('click', () => submitTo("{{ url_for('compress_route') }}"));
		convertBtn.addEventListener('click', () => submitTo("{{ url_for('convert_route') }}"));
	</script>
</body>
</html>
